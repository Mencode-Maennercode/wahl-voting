(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[977],{5601:function(e,t,a){Promise.resolve().then(a.bind(a,47845))},47845:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var n=a(3827),r=a(64090),s=a(47907),i=a(18628),o=a(1221),l=a(58121),d=a(575),c=a(15671),u=a(91679),m=a(77147),f=a(53879),h=a(40834),x=a(63915),p=a(44704),g=a(52644),v=a(22169);function w(){let{association:e,isAuthenticated:t,isLoading:a}=(0,i.useAuth)(),w=(0,s.useRouter)(),b=(0,s.useParams)(),{toast:N}=(0,m.pm)(),j=b.id,y=(0,r.useRef)(null),[S,A]=(0,r.useState)(null),[D,I]=(0,r.useState)([]),[T,C]=(0,r.useState)(new Map),[k,E]=(0,r.useState)(!0),[O,z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a||t||w.push("/")},[a,t,w]),(0,r.useEffect)(()=>{j&&e&&R()},[j,e]);let R=async()=>{try{let r=(0,l.JU)(o.db,"elections",j),s=await (0,l.QT)(r);if(s.exists()){var t,a,n;let r=s.data();if(r.associationId!==(null==e?void 0:e.id)){w.push("/admin");return}let i={id:s.id,associationId:r.associationId,title:r.title,description:r.description,question:r.question,options:r.options,allowInvalidVotes:r.allowInvalidVotes,electionDate:(null===(t=r.electionDate)||void 0===t?void 0:t.toDate())||new Date,maxVoters:r.maxVoters,invitationText:r.invitationText,showLinkWithCode:r.showLinkWithCode||!1,status:r.status,codesGenerated:r.codesGenerated,createdAt:(null===(a=r.createdAt)||void 0===a?void 0:a.toDate())||new Date,updatedAt:(null===(n=r.updatedAt)||void 0===n?void 0:n.toDate())||new Date};A(i);let d=(0,l.hJ)(o.db,"voterCodes"),c=(0,l.IO)(d,(0,l.ar)("electionId","==",j)),u=await (0,l.PL)(c),m=[];u.forEach(e=>{var t,a;let n=e.data();m.push({id:e.id,electionId:n.electionId,code:n.code,hasVoted:n.hasVoted,votedAt:null===(t=n.votedAt)||void 0===t?void 0:t.toDate(),createdAt:(null===(a=n.createdAt)||void 0===a?void 0:a.toDate())||new Date})}),I(m),m.length>0&&await _(m,i)}else w.push("/admin")}catch(e){console.error("Error loading data:",e),N({title:"Fehler",description:"Daten konnten nicht geladen werden.",variant:"destructive"})}finally{E(!1)}},_=async(e,t)=>{let a=window.location.origin,n=new Map;for(let t of e){let e="".concat(a,"/abstimmen?code=").concat(t.code);try{let a=await g.toDataURL(e,{width:200,margin:2,color:{dark:"#1e293b",light:"#ffffff"}});n.set(t.id,a)}catch(e){console.error("QR generation error:",e)}}C(n)},V=async()=>{if(S){z(!0);try{let e=(0,l.hJ)(o.db,"voterCodes"),t=(0,l.IO)(e,(0,l.ar)("electionId","==",j)),a=(await (0,l.PL)(t)).docs.map(e=>(0,l.oe)(e.ref));await Promise.all(a);let n=[],r=new Set;for(let t=0;t<S.maxVoters;t++){let t=(0,v.YG)(4);for(;r.has(t);)t=(0,v.YG)(4);r.add(t);let a=await (0,l.ET)(e,{electionId:j,code:t,hasVoted:!1,createdAt:l.EK.now()});n.push({id:a.id,electionId:j,code:t,hasVoted:!1,createdAt:new Date})}await (0,l.r7)((0,l.JU)(o.db,"elections",j),{codesGenerated:!0,updatedAt:l.EK.now()}),I(n),await _(n,S),N({title:"Codes generiert",description:"".concat(S.maxVoters," Stimmzettel wurden erfolgreich erstellt.")}),A({...S,codesGenerated:!0})}catch(e){console.error("Error generating codes:",e),N({title:"Fehler",description:"Codes konnten nicht generiert werden.",variant:"destructive"})}finally{z(!1)}}},L=()=>window.location.origin;return a||k?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-pulse text-slate-500",children:"Laden..."})}):S?(0,n.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,n.jsx)("header",{className:"border-b bg-white sticky top-0 z-50 no-print",children:(0,n.jsxs)("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[(0,n.jsxs)(d.z,{variant:"ghost",onClick:()=>w.push("/admin/wahl/".concat(j)),children:[(0,n.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Zur\xfcck"]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[D.length>0&&(0,n.jsxs)(u.aR,{children:[(0,n.jsx)(u.vW,{asChild:!0,children:(0,n.jsxs)(d.z,{variant:"outline",children:[(0,n.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Neu generieren"]})}),(0,n.jsxs)(u._T,{children:[(0,n.jsxs)(u.fY,{children:[(0,n.jsx)(u.f$,{children:"Codes neu generieren?"}),(0,n.jsx)(u.yT,{children:"Alle bestehenden Codes werden gel\xf6scht und neue erstellt. Bereits gedruckte Stimmzettel werden ung\xfcltig."})]}),(0,n.jsxs)(u.xo,{children:[(0,n.jsx)(u.le,{children:"Abbrechen"}),(0,n.jsx)(u.OL,{onClick:V,children:"Neu generieren"})]})]})]}),D.length>0&&(0,n.jsxs)(d.z,{onClick:()=>{window.print()},children:[(0,n.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Drucken"]})]})]})}),(0,n.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"no-print mb-8",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Stimmzettel"}),(0,n.jsx)("p",{className:"text-slate-600",children:S.title})]}),0===D.length?(0,n.jsxs)(c.Zb,{className:"max-w-md mx-auto no-print",children:[(0,n.jsxs)(c.Ol,{className:"text-center",children:[(0,n.jsx)(p.Z,{className:"h-12 w-12 text-slate-300 mx-auto mb-4"}),(0,n.jsx)(c.ll,{children:"Stimmzettel generieren"}),(0,n.jsxs)(c.SZ,{children:["Erstellen Sie ",S.maxVoters," einmalige Stimmzettel f\xfcr die Wahl."]})]}),(0,n.jsx)(c.aY,{children:(0,n.jsx)(d.z,{onClick:V,className:"w-full",disabled:O,children:O?"Generieren...":"".concat(S.maxVoters," Stimmzettel erstellen")})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"no-print mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,n.jsxs)("p",{className:"text-green-800",children:[(0,n.jsxs)("strong",{children:[D.length," Stimmzettel"]}),' wurden generiert. Klicken Sie auf "Drucken" um alle Stimmzettel auszudrucken.']})}),(0,n.jsx)("div",{ref:y,className:"space-y-0",children:D.map((e,t)=>(0,n.jsx)("div",{className:"ballot-page bg-white p-8 border border-slate-200 mb-4 print:mb-0 print:border-0",style:{pageBreakAfter:"always"},children:(0,n.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:S.title}),(0,n.jsx)("p",{className:"text-slate-600 mb-6",children:S.invitationText}),(0,n.jsx)("div",{className:"border-t border-b border-slate-200 py-6 my-6",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("p",{className:"text-slate-500",children:"Scannen Sie den QR-Code:"}),T.get(e.id)&&(0,n.jsx)("img",{src:T.get(e.id),alt:"QR Code",className:"mx-auto"}),S.showLinkWithCode&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"text-slate-500 text-sm",children:["Oder besuchen Sie ",L(),"/abstimmen"]}),(0,n.jsxs)("div",{className:"text-2xl font-bold tracking-widest text-slate-800",children:["Code: ",e.code]})]})]})}),(0,n.jsx)("p",{className:"text-xs text-slate-400",children:"Dieser Stimmzettel ist einmalig verwendbar. Bitte bewahren Sie ihn sicher auf."}),(0,n.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:["Stimmzettel ",t+1," von ",D.length]})]})},e.id))})]})]})]}):null}},91679:function(e,t,a){"use strict";a.d(t,{OL:function(){return g},_T:function(){return m},aR:function(){return l},f$:function(){return x},fY:function(){return f},le:function(){return v},vW:function(){return d},xo:function(){return h},yT:function(){return p}});var n=a(3827),r=a(64090),s=a(62489),i=a(22169),o=a(575);let l=s.fC,d=s.xz,c=s.h_,u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});u.displayName=s.aV.displayName;let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(u,{}),(0,n.jsx)(s.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]})});m.displayName=s.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};f.displayName="AlertDialogHeader";let h=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="AlertDialogFooter";let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold",a),...r})});x.displayName=s.Dx.displayName;let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})});p.displayName=s.dk.displayName;let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.aU,{ref:t,className:(0,i.cn)((0,o.d)(),a),...r})});g.displayName=s.aU.displayName;let v=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.$j,{ref:t,className:(0,i.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});v.displayName=s.$j.displayName},575:function(e,t,a){"use strict";a.d(t,{d:function(){return l},z:function(){return d}});var n=a(3827),r=a(64090),s=a(59143),i=a(49769),o=a(22169);let l=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,n.jsx)(u,{className:(0,o.cn)(l({variant:r,size:i,className:a})),ref:t,...c})});d.displayName="Button"},15671:function(e,t,a){"use strict";a.d(t,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return i},aY:function(){return c},ll:function(){return l}});var n=a(3827),r=a(64090),s=a(22169);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",a),...r})});o.displayName="CardHeader";let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});l.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",a),...r})});d.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",a),...r})});c.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},77147:function(e,t,a){"use strict";a.d(t,{pm:function(){return m}});var n=a(64090);let r=0,s=new Map,i=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],d={toasts:[]};function c(e){d=o(d,e),l.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||n()}}}),{id:a,dismiss:n,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=n.useState(d);return n.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},18628:function(e,t,a){"use strict";a.r(t),a.d(t,{AuthProvider:function(){return l},useAuth:function(){return d}});var n=a(3827),r=a(64090),s=a(1221),i=a(58121);let o=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=localStorage.getItem("vereins-wahlen-auth");if(e)try{let t=JSON.parse(e);l(t)}catch(e){localStorage.removeItem("vereins-wahlen-auth")}c(!1)},[]);let u=async(e,t)=>{try{var a,n;let r=(0,i.hJ)(s.db,"associations"),o=(0,i.IO)(r,(0,i.ar)("vereinsNummer","==",e),(0,i.ar)("password","==",t)),d=await (0,i.PL)(o);if(d.empty)return!1;let c=d.docs[0],u=c.data(),m={id:c.id,vereinsNummer:u.vereinsNummer,name:u.name||"",address:u.address,email:u.email,phone:u.phone,createdAt:(null===(a=u.createdAt)||void 0===a?void 0:a.toDate())||new Date,updatedAt:(null===(n=u.updatedAt)||void 0===n?void 0:n.toDate())||new Date};return l(m),localStorage.setItem("vereins-wahlen-auth",JSON.stringify(m)),!0}catch(e){return console.error("Login error:",e),!1}};return(0,n.jsx)(o.Provider,{value:{association:a,isAuthenticated:!!a,isLoading:d,login:u,logout:()=>{l(null),localStorage.removeItem("vereins-wahlen-auth")}},children:t})}function d(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1221:function(e,t,a){"use strict";a.d(t,{db:function(){return o}});var n=a(26142),r=a(58121),s=a(92730);let i=0===(0,n.C6)().length?(0,n.ZF)({apiKey:"AIzaSyAxCOm_i6somJu1nYjUXx2bYpySyWtXXiI",authDomain:"voting-d4906.firebaseapp.com",projectId:"voting-d4906",storageBucket:"voting-d4906.firebasestorage.app",messagingSenderId:"980484045148",appId:"1:980484045148:web:24f68f28a0d46b9f016999"}):(0,n.C6)()[0],o=(0,r.ad)(i);(0,s.v0)(i)},22169:function(e,t,a){"use strict";a.d(t,{YG:function(){return i},cn:function(){return s},mn:function(){return l},p6:function(){return o}});var n=a(75504),r=a(51367);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,n.W)(t))}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",a="";for(let n=0;n<e;n++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}function o(e){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}function l(e){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)}}},function(e){e.O(0,[358,315,581,995,420,570,73,971,69,744],function(){return e(e.s=5601)}),_N_E=e.O()}]);